<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å¹´æœ«ã‚¸ãƒ£ãƒ³ãƒœè‚‰ãã˜</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans",sans-serif;
  margin:0;padding:24px;text-align:center;
  background:#fafafa;color:#111;
}
.wrap{max-width:980px;margin:0 auto;}
.card{
  padding:24px;border-radius:20px;border:1px solid #ddd;background:#fff;
  margin-bottom:16px;
}
h1{margin:0 0 8px}
.sub{opacity:.75;margin-bottom:12px}

.num{
  font-size:96px;font-weight:900;letter-spacing:6px;
  margin:18px 0;padding:18px 0;border-radius:18px;
  border:2px dashed #bbb;color:#111;
}
.num.final{color:#c00 !important;}
.num.shock{
  color:#f00 !important;
  text-shadow:0 0 28px #f00;
  animation:shake .12s infinite;
}

@keyframes shake{
  0%{transform:translate(0)}
  25%{transform:translate(-4px,2px)}
  50%{transform:translate(4px,-2px)}
  75%{transform:translate(-2px,-4px)}
  100%{transform:translate(0)}
}

.row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
button{
  padding:14px 16px;font-size:18px;font-weight:800;
  border-radius:14px;border:none;background:#111;color:#fff;
}
button.secondary{background:#555}
button.small{font-size:14px;padding:10px 12px}
button:disabled{opacity:.5}

.grid{
  display:grid;
  grid-template-columns:repeat(4,minmax(200px,1fr));
  gap:10px;text-align:left;
}
.namebox{
  display:flex;gap:8px;align-items:center;
  border:1px solid #ddd;border-radius:14px;padding:10px;background:#fff;
}

table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border-bottom:1px solid #eee;padding:10px 8px;text-align:left}
th{background:#fafafa}
.right{text-align:right}

body.dark{background:#000;color:#c00}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
  <h1>ğŸ¥© å¹´æœ«ã‚¸ãƒ£ãƒ³ãƒœè‚‰ãã˜ ğŸ¯</h1>
  <div class="sub">å‚åŠ è€…ã®åå‰ã‚’å…¥åŠ› â†’ åå‰ãƒœã‚¿ãƒ³ã§æŠ½é¸</div>

  <div id="num" class="num">---</div>

  <div class="row">
    <button id="bgmBtn" class="secondary">ğŸµ BGM ON</button>
    <button id="voiceBtn" class="secondary">ğŸ¤ è‚‰ãƒœã‚¤ã‚¹ ON</button>
    <button id="resetBtn" class="secondary">ğŸ§¹ è¨˜éŒ²ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
</div>

<div class="card">
  <div class="sub" style="text-align:left"><strong>ğŸ‘¥ å‚åŠ è€…ï¼ˆ8åï¼‰</strong></div>
  <div class="grid" id="nameInputs"></div>
  <div class="row" style="justify-content:flex-start;margin-top:12px">
    <button id="applyNames" class="small">âœ… åå‰ã‚’åæ˜ </button>
  </div>

  <div class="sub" style="text-align:left;margin-top:14px"><strong>ğŸ² æŠ½é¸</strong></div>
  <div class="row" id="nameButtons" style="justify-content:flex-start"></div>
</div>

<div class="card">
  <div class="sub" style="text-align:left"><strong>ğŸ§¾ æŠ½é¸è¨˜éŒ²</strong></div>
  <table>
    <thead>
      <tr>
        <th>åå‰</th>
        <th class="right">æ•°å­—</th>
        <th class="right">å·®</th>
        <th>åˆ¤å®š</th>
      </tr>
    </thead>
    <tbody id="logBody"></tbody>
  </table>
</div>

</div>

<audio id="bgm" loop></audio>

<script>
/* ===== è¨­å®š ===== */
const BGM_FILE='ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ.mp3';
const MIN=0, MAX=100;
const TARGET=29, NEAR=5;
const SPIN_MS=2500;
const TICK_MS=60;
/* ================= */

const numEl=document.getElementById('num');
const bgmBtn=document.getElementById('bgmBtn');
const voiceBtn=document.getElementById('voiceBtn');
const resetBtn=document.getElementById('resetBtn');
const logBody=document.getElementById('logBody');
const nameInputsEl=document.getElementById('nameInputs');
const nameButtonsEl=document.getElementById('nameButtons');
const applyNamesBtn=document.getElementById('applyNames');

const bgm=document.getElementById('bgm');
bgm.src=BGM_FILE;

let bgmOn=false;
let voiceOn=true;
let isRunning=false;

/* ===== iPadå¯¾å¿œ Audio ===== */
let audioCtx;
function ensureAudio(){
  if(!audioCtx){
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  }
  if(audioCtx.state==='suspended'){
    audioCtx.resume();
  }
}
function beep(freq,ms){
  ensureAudio();
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.frequency.value=freq; g.gain.value=.05;
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+ms/1000);
}

/* ===== è‚‰ãƒœã‚¤ã‚¹ ===== */
function speak(text,rate=1,pitch=1){
  if(!voiceOn) return;
  if(!('speechSynthesis'in window)) return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang='ja-JP'; u.rate=rate; u.pitch=pitch;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* ===== ãƒœã‚¿ãƒ³ ===== */
bgmBtn.onclick=()=>{
  ensureAudio();
  if(!bgmOn){
    bgm.volume=.3; bgm.currentTime=0;
    bgm.play().catch(()=>{});
    bgmBtn.textContent='ğŸµ BGM OFF'; bgmOn=true;
  }else{
    bgm.pause();
    bgmBtn.textContent='ğŸµ BGM ON'; bgmOn=false;
  }
};

voiceBtn.onclick=()=>{
  ensureAudio();
  voiceOn=!voiceOn;
  voiceBtn.textContent=voiceOn?'ğŸ¤ è‚‰ãƒœã‚¤ã‚¹ ON':'ğŸ¤ è‚‰ãƒœã‚¤ã‚¹ OFF';
  if(voiceOn) speak('è‚‰ã€å†èµ·å‹•',0.9,1.1);
  else speechSynthesis.cancel();
};

resetBtn.onclick=()=>{logBody.innerHTML='';};

/* ===== å‚åŠ è€… ===== */
let names=Array.from({length:8},(_,i)=>`å‚åŠ è€…${i+1}`);

function renderNameInputs(){
  nameInputsEl.innerHTML='';
  names.forEach((n,i)=>{
    nameInputsEl.innerHTML+=
      `<div class="namebox">${i+1}
       <input id="nameInput${i}" value="${n}" /></div>`;
  });
}
function renderNameButtons(){
  nameButtonsEl.innerHTML='';
  names.forEach((n,i)=>{
    const b=document.createElement('button');
    b.textContent=`ğŸ² ${n}`;
    b.disabled=isRunning;
    b.onclick=()=>spinForName(i);
    nameButtonsEl.appendChild(b);
  });
}
applyNamesBtn.onclick=()=>{
  for(let i=0;i<8;i++){
    names[i]=document.getElementById(`nameInput${i}`).value||`å‚åŠ è€…${i+1}`;
  }
  renderNameButtons();
};

/* ===== æŠ½é¸ ===== */
function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}

function spinForName(index){
  if(isRunning) return;
  isRunning=true;
  ensureAudio();
  beep(120,30);

  numEl.className='num';
  document.body.classList.remove('dark');

  const timer=setInterval(()=>{
    numEl.textContent=String(rand(MIN,MAX)).padStart(3,'0');
  },TICK_MS);

  setTimeout(()=>{
    clearInterval(timer);
    const final=rand(MIN,MAX);
    numEl.textContent=String(final).padStart(3,'0');
    numEl.classList.add('final');

    let verdict='ã‚‚ã£ã¨è‚‰ã‚’æ„›ã›ã‚ˆï¼';
    if(final===TARGET){
      verdict='ãƒŸãƒ¼ãƒˆã‚­ãƒ³ã‚°é™è‡¨';
      speak('ã‚³ãƒ³ã‚°ãƒ©ãƒƒãƒãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ¼ãƒ³ï¼',1.05,1.5);
    }else{
      speak(['è‚‰ã‚’ç„¦ãŒã™ãªã‚ˆ','é£²ã¿ç‰©ã‚’è‚‰æ±ã«','ãƒ‡ã‚¶ãƒ¼ãƒˆã‚‚è‚‰ã«ã—ã‚'][Math.floor(Math.random()*3)],0.95,0.7);
    }

    logBody.innerHTML=
      `<tr><td>${names[index]}</td><td class="right">${final}</td><td class="right">${Math.abs(final-TARGET)}</td><td>${verdict}</td></tr>`+logBody.innerHTML;

    isRunning=false;
  },SPIN_MS);
}

/* åˆæœŸæç”» */
renderNameInputs();
renderNameButtons();
</script>
</body>
</html>
