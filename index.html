<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å¹´æœ«ã‚¸ãƒ£ãƒ³ãƒœè‚‰ãã˜</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans",sans-serif;
  margin:0;padding:24px;text-align:center;
  background:#fafafa;color:#111;transition:.4s;
}
.wrap{max-width:980px;margin:0 auto;}
.card{
  padding:24px;border-radius:20px;border:1px solid #ddd;background:#fff;
  margin-bottom:16px;
}
h1{margin:0 0 8px}
.sub{opacity:.75;margin-bottom:12px}

.num{
  font-size:100px;font-weight:900;letter-spacing:6px;
  margin:18px 0;padding:18px 0;border-radius:18px;
  border:2px dashed #bbb;
  color:#111;
}
.num.final{color:#c00 !important;}

.row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
button{
  padding:14px 16px;font-size:18px;font-weight:800;
  border-radius:14px;border:none;background:#111;color:#fff;
  cursor:pointer;
}
button.secondary{background:#555}
button.small{font-size:14px;padding:10px 12px}
button:disabled{opacity:.5;cursor:not-allowed}

.grid{
  display:grid;
  grid-template-columns: repeat(4, minmax(200px, 1fr));
  gap:10px;
  text-align:left;
}
.namebox{
  display:flex;gap:8px;align-items:center;
  border:1px solid #ddd;border-radius:14px;padding:10px;background:#fff;
}
.namebox input{
  width:100%;
  border:1px solid #ddd;border-radius:10px;padding:8px 10px;
  font-size:14px;
}

table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border-bottom:1px solid #eee;padding:10px 8px;text-align:left}
th{background:#fafafa}
.right{text-align:right}

/* 100 é—‡å •ã¡ */
body.dark{background:#000;color:#c00}
.num.shock{
  color:#f00 !important;
  text-shadow:0 0 28px #f00;
  animation:shake .12s infinite;
}
@keyframes shake{
  0%{transform:translate(0,0)}
  25%{transform:translate(-4px,2px)}
  50%{transform:translate(4px,-2px)}
  75%{transform:translate(-2px,-4px)}
  100%{transform:translate(0,0)}
}

/* ===== åˆ¤å®šæ–‡å­—ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ===== */
#resultOverlay{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
  pointer-events:none;
}
#resultOverlay.show{display:flex}

#resultText{
  font-weight:900;
  text-align:center;
  line-height:1.2;
  padding:28px 36px;
  border-radius:22px;
}

.result-win{
  background:rgba(0,0,0,.75);
  color:#ffd700;
  font-size:64px;
  animation:zoom 1.2s ease-out;
}
.result-near{
  background:rgba(255,80,0,.85);
  color:#fff;
  font-size:48px;
  animation:shakeText .8s infinite;
}
.result-lose{
  background:rgba(0,0,0,.7);
  color:#fff;
  font-size:42px;
  animation:pop .8s ease-out;
}
.result-doom{
  background:#000;
  color:#f00;
  font-size:56px;
  animation:fadein 1.5s ease-out;
}

/* â˜…é›·ç‚¹æ»…ï¼ˆ29Â±5å°‚ç”¨ï¼‰ */
body.thunder{
  animation:thunderFlash .15s infinite;
}
@keyframes thunderFlash{
  0%{background:#fafafa;color:#111}
  50%{background:#000;color:#fff}
  100%{background:#fafafa;color:#111}
}

/* â˜…è‚‰ã®ç¥ æ¥è¿‘ä¸­ */
.result-god{
  background:rgba(0,0,0,.85);
  color:#ff0;
  font-size:52px;
  text-shadow:0 0 18px #ff0;
}

@keyframes zoom{
  0%{transform:scale(.2)}
  60%{transform:scale(1.15)}
  100%{transform:scale(1)}
}
@keyframes shakeText{
  0%{transform:translate(0)}
  25%{transform:translate(-10px,6px)}
  50%{transform:translate(10px,-6px)}
  75%{transform:translate(-8px,-8px)}
  100%{transform:translate(0)}
}
@keyframes pop{
  0%{transform:scale(0)}
  100%{transform:scale(1)}
}
@keyframes fadein{
  0%{opacity:0}
  100%{opacity:1}
}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
  <h1>ğŸ¥© å¹´æœ«ã‚¸ãƒ£ãƒ³ãƒœè‚‰ãã˜ ğŸ¯</h1>
  <div class="sub">å‚åŠ è€…ã®åå‰ã‚’å…¥åŠ› â†’ åå‰ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æŠ½é¸</div>
  <div class="sub">ä¸€äºº5å›ãšã¤æŠ½é¸ã€ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢ã§å‹è² ï¼èª°ã‚‚29ã‚’å¼•ã‘ãªã‘ã‚Œã°ãƒªã‚»ãƒƒãƒˆãƒªãƒˆãƒ©ã‚¤ï¼</div>
  <div id="num" class="num">---</div>
  <div class="row">
    <button id="bgmBtn" class="secondary">ğŸµ BGM ON</button>
    <button id="resetBtn" class="secondary">ğŸ§¹ è¨˜éŒ²ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
</div>

<div class="card">
  <div class="sub" style="text-align:left;margin-bottom:10px"><strong>ğŸ‘¥ å‚åŠ è€…ï¼ˆ8åï¼‰</strong></div>
  <div class="grid" id="nameInputs"></div>
  <div class="row" style="margin-top:12px;justify-content:flex-start">
    <button id="applyNames" class="small">âœ… åå‰ã‚’åæ˜ </button>
  </div>
  <div class="sub" style="text-align:left;margin-top:14px;margin-bottom:8px"><strong>ğŸ¯ æŠ½é¸</strong></div>
  <div class="row" id="nameButtons" style="justify-content:flex-start"></div>
</div>

<div class="card">
  <div class="sub" style="text-align:left;margin-bottom:8px"><strong>ğŸ§¾ æŠ½é¸è¨˜éŒ²</strong></div>
  <table>
    <thead>
      <tr>
        <th>åå‰</th>
        <th class="right">æ•°å­—</th>
        <th class="right">29ã¨ã®å·®</th>
        <th>åˆ¤å®š</th>
      </tr>
    </thead>
    <tbody id="logBody"></tbody>
  </table>
</div>

</div>

<div id="resultOverlay">
  <div id="resultText"></div>
</div>

<audio id="bgm" loop></audio>

<script>
/* ===== ç’°å¢ƒåˆ¤å®š ===== */
const IS_IPAD = /iPad|Macintosh/.test(navigator.userAgent) && 'ontouchend' in document;

/* ===== è¨­å®š ===== */
const BGM_FILE='ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ.mp3';
const MIN=0, MAX=100;
const TARGET=29, NEAR=5;
const SPIN_MS=2500;
const TEASE_TOTAL_MS=10000;
const TICK_MS=60;

/* ===== DOM ===== */
const numEl=document.getElementById('num');
const bgmBtn=document.getElementById('bgmBtn');
const resetBtn=document.getElementById('resetBtn');
const logBody=document.getElementById('logBody');
const nameInputsEl=document.getElementById('nameInputs');
const nameButtonsEl=document.getElementById('nameButtons');
const applyNamesBtn=document.getElementById('applyNames');
const overlay=document.getElementById('resultOverlay');
const overlayText=document.getElementById('resultText');

const bgm=document.getElementById('bgm');
bgm.src=BGM_FILE;

let bgmOn=false, isRunning=false;

/* ===== Audio ===== */
let audioCtx;
function ensureAudio(){
  if(!audioCtx){
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  }
  if(audioCtx.state==='suspended') audioCtx.resume();
}
function beep(freq,ms,type='sine',gain=.05){
  ensureAudio();
  const t=audioCtx.currentTime;
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.type=type;o.frequency.value=freq;g.gain.value=gain;
  o.connect(g).connect(audioCtx.destination);
  o.start(t);o.stop(t+ms/1000);
}
function doomSound(){
  ensureAudio();
  const t=audioCtx.currentTime;
  const o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.type='sawtooth';o.frequency.setValueAtTime(80,t);
  g.gain.setValueAtTime(.15,t);
  o.connect(g).connect(audioCtx.destination);
  o.start(t);o.stop(t+.9);
}

/* ===== PCè‚‰ãƒœã‚¤ã‚¹ ===== */
function speak(text,rate,pitch){
  if(IS_IPAD) return;
  if(!('speechSynthesis'in window))return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang='ja-JP';u.rate=rate;u.pitch=pitch;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* ===== è¡¨ç¤º ===== */
function showResultText(html, cls, ms=2500){
  overlayText.className=cls;
  overlayText.innerHTML=html;
  overlay.classList.add('show');
  setTimeout(()=>overlay.classList.remove('show'), ms);
}

/* ===== BGM ===== */
bgmBtn.onclick=()=>{
  ensureAudio();
  beep(120,20,'sine',.001);
  if(!bgmOn){
    bgm.volume=.3; bgm.currentTime=0; bgm.play().catch(()=>{});
    bgmBtn.textContent='ğŸµ BGM OFF'; bgmOn=true;
  }else{
    bgm.pause(); bgmBtn.textContent='ğŸµ BGM ON'; bgmOn=false;
  }
};

/* ===== å‚åŠ è€… ===== */
let names=Array.from({length:8},(_,i)=>`å‚åŠ è€…${i+1}`);

function renderNameInputs(){
  nameInputsEl.innerHTML='';
  names.forEach((n,i)=>{
    const d=document.createElement('div');
    d.className='namebox';
    d.innerHTML=
      `<div style="min-width:22px;font-weight:800">${i+1}</div>
       <input id="nameInput${i}" value="${escapeHtml(n)}" />`;
    nameInputsEl.appendChild(d);
  });
}
function renderNameButtons(){
  nameButtonsEl.innerHTML='';
  names.forEach((n,i)=>{
    const b=document.createElement('button');
    b.textContent=`ğŸ² ${n}`;
    b.disabled=isRunning;
    b.onclick=()=>spinForName(i);
    nameButtonsEl.appendChild(b);
  });
}
applyNamesBtn.onclick=()=>{
  for(let i=0;i<8;i++){
    const v=document.getElementById(`nameInput${i}`).value.trim();
    names[i]=v||`å‚åŠ è€…${i+1}`;
  }
  renderNameButtons();
};
resetBtn.onclick=()=>{logBody.innerHTML='';};

function setButtonsDisabled(dis){
  isRunning=dis;
  Array.from(nameButtonsEl.querySelectorAll('button')).forEach(b=>b.disabled=dis);
}

function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function resetVisual(){
  document.body.classList.remove('dark','thunder');
  numEl.classList.remove('shock','final');
  numEl.style.color='#111';
}
function setFinalColor(){
  numEl.classList.add('final');
  numEl.style.color='#c00';
}

/* â˜…å¤–ã‚Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
const meatMessages=[
  'ğŸ¥© ã‚‚ã£ã¨è‚‰ã‚’æ„›ã›ã‚ˆï¼',
  'ğŸ¥© è‚‰ã‚’ç„¦ãŒã—ãŸã‚Šã—ã¦ãªã„ã‚ˆã­ï¼Ÿ',
  'ğŸ¥© ãƒ‰ãƒªãƒ³ã‚¯ã‚’è‚‰æ±ã«ã—ã¦ã¿ã‚‹ï¼Ÿ',
  'ğŸ¥© ãƒ‡ã‚¶ãƒ¼ãƒˆã¯è‚‰è¿½åŠ ã ã‚ˆã­ï¼Ÿ',
  'ğŸ¥© é‡èœï¼Ÿãªã«ãã‚Œï¼Ÿ',
  'ğŸ¥© ã‚‚ã—ã‹ã—ã¦100ç•ªå¼•ããŸã‹ã£ãŸï¼Ÿ',
  'ğŸ¥© ã‚«ãƒ«ãƒ“2äººå‰è¿½åŠ ã—ã¨ãï¼Ÿ',
  'ğŸ¥© ãªã¤ã‹ã—ã®ç‰›ã‚¿ãƒ³ã‚²ãƒ¼ãƒ ã‚„ã‚ŠãŸã„äººï¼Ÿ',
  'ğŸ¥© é­šãŒé£Ÿã¹ãŸã„ã¨ã‹è¨€ã£ã¦ãªã„ã‚ˆã­ï¼Ÿ',
  'ğŸ¥© ã«ã‚“ã«ãã‚‚è‚‰ã®ä¸€ç¨®ã ã‚ˆã­',
  'ğŸ¥© 14å¼•ã„ãŸã‚‰è‚‰é£Ÿã¹ã¦ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒ¼ï¼ï¼ã¨å«ã¶ã“ã¨',
  'ğŸ¥© ãƒ­ã‚¤ãƒ›ã«è‚‰ãƒ‘ãƒ•ã‚§ã¯ãªã„ã‚ˆ',
  'ğŸ¥© ã‚ã¤ã„è‚‰ã¯åˆ¥è…¹',
  'ğŸ¥© æ¬¡ã¯2æœˆ9æ—¥ã§å¹¹äº‹ã‚ˆã‚ã—ã'
];
function randomMeatMessage(){
  return meatMessages[Math.floor(Math.random()*meatMessages.length)];
}

function verdictText(final){
  if(final===100) return 'ğŸ˜ˆ è‚‰ã«è¦‹æ”¾ã•ã‚Œã—è€…';
  if(final===TARGET) return 'ğŸ‘‘ ãƒŸãƒ¼ãƒˆã‚­ãƒ³ã‚°ï¼ãƒŸãƒ¼ãƒˆã‚¯ã‚¤ãƒ¼ãƒ³é™è‡¨';
  if(Math.abs(final-TARGET)<=NEAR) return 'ğŸ”¥ è‚‰ã®ç¥ã¨ã™ã‚Œé•ã£ãŸè€…';
  return '';
}

const normalVoices=['è‚‰ã‚’ç„¦ãŒã™ãªã‚ˆ','é£²ã¿ç‰©ã‚’è‚‰æ±ã«ã—ãŸã‚‰ï¼Ÿ','ãƒ‡ã‚¶ãƒ¼ãƒˆã‚‚è‚‰ã«ã—ã‚'];
function randomNormalVoice(){
  return normalVoices[Math.floor(Math.random()*normalVoices.length)];
}

/* ===== æŠ½é¸ ===== */
function spinForName(index){
  if(isRunning) return;
  ensureAudio();
  beep(120,20,'sine',.001);
  setButtonsDisabled(true);
  resetVisual();

  const spinTimer=setInterval(()=>{
    numEl.textContent=String(randInt(MIN,MAX)).padStart(3,'0');
  },TICK_MS);

  setTimeout(()=>{
    clearInterval(spinTimer);
    const final=randInt(MIN,MAX);
    const diff=Math.abs(final-TARGET);
    let finalMessage='';

    const showFinal=()=>{
      numEl.textContent=String(final).padStart(3,'0');

      if(final===100){
        if(bgmOn) bgm.pause();
        document.body.classList.add('dark');
        numEl.classList.add('shock');
        doomSound();
        finalMessage='ğŸ˜ˆ è‚‰ã«è¦‹æ”¾ã•ã‚Œã—è€…â€¦';
        showResultText(finalMessage,'result-doom',3000);
        setTimeout(()=>{
          logResult(names[index],final,finalMessage);
          setButtonsDisabled(false);
        },1200);
        return;
      }

      setFinalColor();

      if(final===TARGET){
        finalMessage='ğŸ‘‘ ã‚ãªãŸãŒãƒŸãƒ¼ãƒˆã‚­ãƒ³ã‚°ï¼ãƒŸãƒ¼ãƒˆã‚¯ã‚¤ãƒ¼ãƒ³ã ï¼ï¼';
        showResultText(finalMessage,'result-win',3500);
        speak('ã‚³ãƒ³ã‚°ãƒ©ãƒƒãƒãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ¼ãƒ¼ãƒ¼ãƒ³ï¼ï¼',1.05,1.6);
      }else if(diff<=NEAR){
        finalMessage='ğŸ”¥ è‚‰ã®ç¥ã¨ã™ã‚Œé•ã£ãŸï¼ï¼';
        showResultText(finalMessage,'result-near',2500);
        speak(randomNormalVoice(),0.95,0.6);
      }else{
        finalMessage=randomMeatMessage();
        showResultText(finalMessage,'result-lose',1800);
        speak(randomNormalVoice(),0.95,0.6);
      }

      logResult(names[index],final,finalMessage);
      setButtonsDisabled(false);
    };

    if(diff<=NEAR){
      if(bgmOn) bgm.volume=.15;
      document.body.classList.add('thunder');
      showResultText('âš¡ è‚‰ã®ç¥ æ¥è¿‘ä¸­ï¼ï¼ âš¡','result-god',TEASE_TOTAL_MS);

      const tease=setInterval(()=>{
        numEl.textContent=
          String(randInt(TARGET-NEAR,TARGET+NEAR)).padStart(3,'0');
      },TICK_MS);

      setTimeout(()=>{
        clearInterval(tease);
        document.body.classList.remove('thunder');
        overlay.classList.remove('show');
        if(bgmOn) bgm.volume=.3;
        setTimeout(showFinal,600);
      },TEASE_TOTAL_MS);
    }else{
      showFinal();
    }
  },SPIN_MS);
}

function logResult(name,final,judgeText){
  const diff=Math.abs(final-TARGET);
  const tr=document.createElement('tr');
  tr.innerHTML=
    `<td><strong>${escapeHtml(name)}</strong></td>
     <td class="right">${final}</td>
     <td class="right">${diff}</td>
     <td>${escapeHtml(judgeText || verdictText(final))}</td>`;
  logBody.prepend(tr);
}

function escapeHtml(s){
  return String(s)
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#39;");
}

/* åˆæœŸæç”» */
renderNameInputs();
renderNameButtons();
</script>
</body>
</html>
